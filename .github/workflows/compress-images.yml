name: ğŸ—œï¸ Auto Compress Images

on:
  push:
    paths:
      - 'static/img/uploads/**'
    branches:
      - main
  workflow_dispatch:  # ì´ ì¤„ ì¶”ê°€        

jobs:
  compress:
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“‚ Checkout repository
      uses: actions/checkout@v4
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        fetch-depth: 0
    
    - name: ğŸ—œï¸ Compress Images
      uses: calibreapp/image-actions@main
      with:
        githubToken: ${{ secrets.GITHUB_TOKEN }}
        compressOnly: true
        # ì••ì¶• ì„¤ì •
        jpegQuality: 85
        pngQuality: 85
        webpQuality: 85
        # NFP ë””ìì¸ ìµœì í™” ì„¤ì •
        ignorePaths: 'node_modules/**,dist/**,.git/**'
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        
    - name: ğŸ“¤ Commit compressed images
      run: |
        git config --local user.email "nfp-compress-bot@github.com"
        git config --local user.name "NFP Compress Bot"
        git add .
        if git diff --cached --quiet; then
          echo "ğŸ“¸ No images to compress"
        else
          git commit -m "ğŸ—œï¸ Auto compress images [skip ci]"
          git push
          echo "âœ… Images compressed and committed"
        fi